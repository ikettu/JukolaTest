language: node_js
node_js:
  - 0.8
env:
  - X_SENCHA_CMD_VERSION="6.1.3"
before_script:
  # Framebuffer for Firefox
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  # Install JSDuck dependency
  - "gem install jsduck"
  # Download, unzip and symlink Sencha Ext JS dependency
  #- "wget http://cdn.sencha.com/ext/commercial/ext-4.2.1-commercial.zip"
  #- "unzip -q ext-4.2.1-commercial.zip"
  #- "ln -sv `pwd`/ext-4.2.1.883 $TRAVIS_BUILD_DIR/../ext"
  # Install Sencha Cmd
  #http://cdn.sencha.com/cmd/6.1.3/no-jre/SenchaCmd-6.1.3-linux-amd64.sh.zip
  - "wget http://cdn.sencha.com/cmd/$X_SENCHA_CMD_VERSION/no-jre/SenchaCmd-$X_SENCHA_CMD_VERSION-linux-amd64.sh.zip"
  - "unzip SenchaCmd-$X_SENCHA_CMD_VERSION-linux-amd64.sh.zip"
  - "chmod +x SenchaCmd-$X_SENCHA_CMD_VERSION.*-linux-amd64.sh"
  - "./SenchaCmd-$X_SENCHA_CMD_VERSION.*-linux-amd64.sh -q -dir ~/bin/Sencha/Cmd/$X_SENCHA_CMD_VERSION"
  # Make Sencha Cmd and CoffeeScript available in the PATH
  #- ls -al ~/bin/Sencha/Cmd/$X_SENCHA_CMD_VERSION.*/
  - "export PATH=~/bin/Sencha/Cmd/$X_SENCHA_CMD_VERSION/:$TRAVIS_BUILD_DIR/node_modules/karma/bin:$TRAVIS_BUILD_DIR/node_modules/coffee-script/bin:$PATH"
  # Change directory to the package and build the package
  - "cd $TRAVIS_BUILD_DIR/JukolaApp && sencha app build"
  # Change directory back to the root of the repository ready for running tests
  - "cd $TRAVIS_BUILD_DIR"
deploy:
  provider: s3
  access_key_id: "AKIAJWVD6C3522MIUEVA"
  secret_access_key:
    secure: "a+hyV/xB1en1+hmZ72ghx25QBoutqwHevOVwB1A6vUQ/I+yYRTCmUn6WTeXj2XS7VhlX5NDFE100uIWZ9iOL2fDXHT7MfXT3aUnoUlZYUHHf2qKGfhDwPIk0w9/RJCYVRn4QtxoOc6yu7ObHenScZGyuDorMt0sR04wTsP8iRnB/Y9TDDVzlL0uDnFNqHGckdei2RumvIcff4OJai5kimaJ0LC/o7J63AneHLrIIBoD18dTaPUwWLi9Yj9FqAqmFJGQsIWV9mADlUjDuXcxB/8CuuQ0FA3HlU0X9IdF7T/HdeYhmmdZTAQkh1Fq8PF33FJvfnEqIjRTQPbEsoXR2gLo+JwbgH4lPXjn/y7f3Hs9ELp6FtNECAOFqLlhr/6b0mwTJivhEjsk43QzVke4P1E1RX+0Tm51hOR1psusskL0WTcQvpqtVUZ5hF9TzBLt3J6HnYYVzgErwhB+54EEdQzg3RY5f7mvwFaqDaDvdqhyYaf5ygn/I4n/or4IBYyPMmE6R65P35UDAUWcpQqos/sdLPgNbYeE4z1AMKY4Lm19Ih+WCCT+mbK8jAlTnAVdvEQOhznROh6CFRUlVe/6WhRmvsS0ru+cOXHydSlRTxodgCw1V65z80A3fSMCAsOZd9+bZf6biPZsjoZUBngtjTFrMBZ4Avj/D4xkT8d/95no="
  bucket: "jukolatest"
  region: eu-west-1
  skip_cleanup: true
  local_dir: build/production/JukolaApp
